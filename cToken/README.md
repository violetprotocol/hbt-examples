# cERC20: Compliant ERC20 Token

This is a proof of concept of an Compliant ERC20 (cERC20) token made possible through the use of Humanbound where users must be verified to be compliant and issued a Humanbound token before being able to transact with a cERC20 token.

The cERC20 token demonstrates 2 main implementation flows:

- Minting/burning
- Wrapping/Unwrapping

Minting/burning follows the traditional token lifecycle where tokens are created and destroyed directly to and from wallets by the contract administrator. This is the simplest method for creating and destroying cERC20 tokens.

Wrapping/unwrapping is a new feature made possible by cERC20. Many popular tokens already exist in the permissionless space, but are without the guarantees of being compliant. Thus it may be dangerous from a regulatory standpoint for some players to be seen transacting using these tokens. By wrapping tokens, you are able to take a token like USDC, and convert it to cUSDC through verified Humanbound users, and transact it with guarantees that the flow of the token will and always has passed through clean hands.

## Notes

- The smart contract `cERC20.sol` implements both flows in the same contract, but in practice we recommend that only one of them is used to simplify the management of the contract.
- In practice, the `cERC20.sol` contract would point to the production Humanbound smart contracts, but for testing it would point to your dummy local deployment.
- We used a dummy ERC20 token to demonstrate wrapping and unwrapping flows. This in practice would be used to create compliant versions of existing tokens such as USDC or DAI.

# Testing locally

## Requirements

It's required that you have `yarn` installed. If you don't, simply run `npm i -g yarn`.

<br/>

## Setup

At the root of the project, install all the dependencies:

```
yarn install
```

Let‚Äôs make sure the types generated by typechain (smart contract typing) are copied to the frontend. Inside the `hardhat` folder, run:

```solidity
yarn run typechain
```

Then, you can run the frontend, and local blockchain node all from 1 single terminal instance.
To do so, run the following command from the project's root directory.

```bash
yarn dev
```

This uses a package called `concurrently` that allows you to concurrently run all instances from a single terminal.

Once the app is running, you can view at:

- Frontend [http://localhost:3000](http://localhost:3000/)

It also starts a [local network with Hardhat](https://hardhat.org/hardhat-network/docs/overview). You can connect to it via Metamask using this RPC url: [`http://127.0.0.1:8545`](http://127.0.0.1:8545/)

You'll need funds for your address to interact with the smart contracts locally, so in the `hardhat` folder run:

```bash
npx hardhat --network localhost fund --to <your-address>
```

Now in the same folder, deploy the mock Humanbound Token contract by running:

```bash
npx hardhat run --network localhost scripts/deployHBT.ts
```

Next deploy the mock ERC20 Token contract by running:

```bash
npx hardhat run --network localhost scripts/deployERC20.ts
```

Both deployments will print out the address of the deployed contracts. Populate the variables in `scripts/deploycERC20.ts` with these addresses and then deploy the `cERC20` token with:

```bash
npx hardhat run --network localhost scripts/deploycERC20.ts
```

Now populate the contract address config in `frontend/src/shared/config/contracts.ts` for `Web3ChainReference.EIP155_HARDHAT_LOCAL` for all three contracts.

We‚Äôre ready to go! üöÄ

## Step 1: Claiming a HBT

Before being able to interact with anything, you will need to mint yourself a mock HBT.

Note: In practice, you would use the real HBT contract but for demonstration purposes, we'll be using the MockHBT that you deployed earlier.

Go to the home page [http://localhost:3000/](http://localhost:3000/) to mint yourself a ‚Äúmock HBT‚Äù.

Once minted, the frontend should inform you that you now own a HBT.

## Step 2: Obtaining some cERC20

### Minting

Now armed with your HBT, you'll be able to get some cERC20! You can try this before you've minted a HBT and you'll find that you are unable to as only HBT holders can gain access to cERC20.

Go to the mint page [http://localhost:3000/mint](http://localhost:3000/mint) to mint some cERC20 tokens. Each mint drips you 10 CERC.

Now you can play around with the cERC20 tokens!

### Wrapping

An alternative method for obtaining cERC20 is by 'wrapping' a normal ERC20 token.

Go to the wrap page [http://localhost:3000/wrap](http://localhost:3000/wrap).

First we will obtain some ERC20 tokens by clicking "Claim". This will drip you 10 ERC20 tokens.

Next we will convert this ERC20 into compliant cERC20 by inserting "10" in the box and clicking "Wrap ERC20". This will wrap 10 of your non-compliant tokens and turn them into cERC20!

Once you're done with cERC20 and you want them back in ERC20 to trade them on permissionless DeFi, simply "Unwrap" the desired amount of cERC20 tokens and they will be converted back to ERC20.

## Step 3: Trading your cERC20

Next we will trade some cERC20 tokens.

Note: Your trade recipient must also be a HBT owner or your trade will fail!

Go to the swap page [http://localhost:3000/swap](http://localhost:3000/swap).

This page allows you to send some tokens to a recipient, and so although this isn't strictly a 'swap', this can be easily implemented by exchanges to allow swaps between different cERC20 tokens such as cUSDC or cDAI.

Simply input the recipient address and the amount of cERC20 you wish to send, and click "Transfer".

You will have successfully transferred some tokens!

## Troubleshooting

- Balances appearing incorrect

‚áí Try refreshing the page

- "Received invalid block tag X. Latest block number is Y‚Äù

‚áí Switch network with your wallet and switch back to the local network. See [this answer](https://ethereum.stackexchange.com/a/112214).

- Issue with nonces

‚áí Enable custom nonces in Metamask and manually enter the right nonce value when submitting a transaction.

# Credits

- [create-ether-dapp](https://github.com/adriandelgg/create-ether-dapp)
